<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
    <th:block th:replace="/fragments/head.html :: thHead(pageCss='/css/login/login.css')"></th:block>
    <body>
        <div class="login-wrap">
            <div class="prev_btn pt80 pb15">
                <a href="javascript:history.back()"><img th:src="@{/img/login/prev_arrow.png}" alt="화살표" class="mr5"> 뒤로가기</a>
            </div>
            <div class="login-box">
                <h2><img th:src="@{/img/common/logo_b.png}"></h2>
                <h3 class="mt20 mb20">로그인</h3>
<!--                <form class="login-form" id="login-form" action="/login" method="post">-->
                <form class="login-form" name="login-form" id="login-form" action="/loginAjax" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                    <input class="mb10" type="text" id="userId" name="userId" placeholder="아이디">
                    <input type="password" id="userPwd" name="userPwd" placeholder="비밀번호">

                    <ul class="login-ul">
                        <li><a href="">정보 찾기</a></li>
                        <li><a href="">회원가입</a></li>
                    </ul>

                    <button class="login-btn" type="submit">로그인</button>
                </form>
                <div class="login-msg mt20" th:text="${#request.getAttribute('loginFailMsg')}">message here</div>
            </div>
        </div>

        <th:block th:replace="/fragments/footer.html :: thJs"></th:block>
        <script>
            $(function(){
                var csrfHeader = $('meta[name="_csrf_header"]').attr('content')
                var csrfToken = $('meta[name="_csrf"]').attr('content')

                $('#login-form').submit(function(event){
                    event.preventDefault();
                    // var params = "userId=" + $('#userId').val() + "&userPwd=" + $('#userPwd').val()
                    // var params = {
                    //     'userId' : $("#userId").val(),
                    //     'userPwd' : $("#userPwd").val()
                    // }
                    var queryString = $("form[name=login-form]").serialize() ;
                    $.ajax({
                        url : "/loginAjax",
                        type : "post",
                        // contentType: "application/json",
                        // dataType:'json',
                        // data : JSON.stringify(params),
                        data : queryString,
                        // beforeSend: function(xhr) {
                        //     xhr.setRequestHeader(csrfHeader, csrfToken);
                        // },
                        success : function(response) {
                            if(response.result == "success") {
                                location.href = "/";
                            }else{
                                alert(response.message);
                            }
                        }, error : function(jqXHR, status, e) {
                            console.error(status + " : " + e);
                        }

                    });
                });
            });

        </script>
    </body>
</html>
